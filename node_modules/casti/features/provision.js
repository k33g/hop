require('shelljs/global')
const {Success, Failure} = require('../libs/types')

let provision = {
  shell: (sh_script) => {
    try {
      let result = exec(sh_script.split("\n").map(item => item.trim()).join("\n"))
      if(result.code !== 0) { 
        return Failure.of(result.stderr) 
      }
      return Success.of(result.stdout)
    } catch (error) {
      return Failure.of(error.message)
    }
  },
  gitInitialization: (application) => {
    let sh_script = `
      cd ${application.localPath}/${application.name}
      git init
      git add .
      git commit -m "First üöÄ of ${application.displayName}"
      git remote add clever git+ssh://git@push-par-clevercloud-customers.services.clever-cloud.com/${application.id}.git
    `
    try {
      let result = exec(sh_script.split("\n").map(item => item.trim()).join("\n"))
      if(result.code !== 0) { 
        return Failure.of(result.stderr) 
      }
      return Success.of(result.stdout)
    } catch (error) {
      return Failure.of(error.message)
    }    
  },
  gitPush: (application) => {
    let sh_script = `
      cd ${application.localPath}/${application.name}
      git push clever master
    `
    try {
      let result = exec(sh_script.split("\n").map(item => item.trim()).join("\n"))
      if(result.code !== 0) { 
        return Failure.of(result.stderr) 
      }
      return Success.of(result.stdout)
    } catch (error) {
      return Failure.of(error.message)
    }    
  },
  gitClone: (source, target) => {
    /*
    provision.shell(`
      echo "It could be long... Please be patient ‚è≥"; 
      git clone https://github.com/sdelements/lets-chat.git ${process.cwd()}/application/${letsChatApp.name};
    `)
    */
    provision.shell(`
      echo "It could be long... Please be patient ‚è≥"; 
      git clone ${source} ${target};
    `)
  }


}

module.exports = provision
